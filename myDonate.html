<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UMSA Landing Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="..."
    />
    <link
      href="https://cdn.jsdelivr.net/npm/swiffy-slider@1.6.0/dist/css/swiffy-slider.min.css"
      rel="stylesheet"
      crossorigin="anonymous"
    />
    <style>
      table {
          width: 100%;
          border-collapse: collapse;
      }
      table, th, td {
          border: 1px solid black;
      }
      th, td {
          padding: 10px;
          text-align: center;


      }
      td {
        font-size: 13px;
      }
      #transactionForm {
          margin-top: 20px;
      }
      
      /* General form styling */
      form {
        padding: 10px;
        /* background-color: #f9f9f9; */
        /* border: 1px solid #ddd; */
        /* border-radius: 5px; */
        /* box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); */
      }
      /* Labels */
      form label {
        display: block;
        font-weight: bold;
        font-size: 14px;
        margin-bottom: 10px;
        color: #555;
      }
    
      /* Inputs */
      form input[type="text"],
      form input[type="number"],
      form input[type="hidden"] {
        width: 100%;
        padding: 5px;
        margin-bottom: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
        box-sizing: border-box;
      }
      form select{
        width: 100%;
        padding: 5px;
        margin-bottom: 5px;
        margin-top: 2px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
        box-sizing: border-box;
      }
      .pay{
        width: 100%;
        padding: 5px;
        margin-top: 23px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 14px;
        box-sizing: border-box;
        background-color: #3BCF93;
        color: white;
      }
    
      /* Button styling */
      /* form button {
        width: 100%;
        padding: 10px 15px;
        font-size: 16px;
        color: #fff;
        background-color: #3BCF93;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      } */
    
      form button:hover {
        background-color: mediumsea#3BCF93;
      }
    
      /* Add spacing for better alignment */
      form label,
      form input {
        margin-top: 2px;
      }
  </style>
      
    

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="bg-dark align-text-center pt-4 pb-3 align-middle">
      <div class="d-flex justify-content-between row pt-1  text-white  m-auto " style="width: 87%; margin: auto;">
        <div class="col-lg-4 col-md-4">
          <div class="d-flex justify-content-start  gap-2  ">
            <img class="bg-white contact"  src="./images/icon/email.png" alt="">
            <img class="bg-white contact"  src="./images/icon/yt.png" alt="">
            <img class="bg-white contact"  src="./images/icon/fb.png" alt="">
            <img class="bg-white contact"  src="./images/icon/in.png" alt="">
            <img class="bg-white contact"  src="./images/icon/telegram.png" alt="">
            <img class="ms-3 bg-white contact"  src="./images/icon/phone.png" alt="">
            <b class="nav-link text-white">+880-2353-352-555</b>
  
          </div>
        </div>
        <div class="d-flex justify-content-end gap-2 col-lg-6 col-md-6 text-white">
          <div class="nav-link"><a class="text-decoration-none textgray hov"  href="aboutUs.html">About Us</a></div><p> | </p>
          <div class="nav-link"><a class="text-decoration-none textgray hov" href="service.html">Services</a></div><p> | </p>
          <div class="nav-link"><a class="text-decoration-none textgray hov" href="contactus.html">Contact Us</a></div>
          <div class=""><a class="nav-link login-menu px-2" href="login.html"><b>üîí Login</b></a></div>
          <div class=""><a class="nav-link sign-menu" href="registration.html"><b>üë§ Sign_Up</b></a></div>
          <div class=""><a class="nav-link profile-menu d-none px-2" href="dashboard.html"><b>‚ò∫ Profile</b></a></div>
          <div class=""><a class="nav-link logout-menu d-none" onclick="handlelogOut()" href="#" ><b>‚èª Logout</b></a></div>
          
        
        </div>
      </div>
    </div>
    <nav  class="navbar navbar-dark navbar-expand-lg  py-3 sticky-top ">
      <div class="container-fluid " style="width: 87%; margin: auto;">
          <a class="navbar-brand lgo  " href="index.html">
              <img style="width: 40px;height: 40px;" src="./images/umsalogo.png" alt="Logo"  class="d-inline-block align-text-top ">
              UMSA
            </a>
            <!-- <a style="text-decoration: none;" class="p-2 ms-auto mx-4 text-white btc btn" href="myDonate.html">Donate</a> -->
        <button style="background-color: #3BCF93;" class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
          <span  class="navbar-toggler-icon"></span>
        </button>
        <div  class="offcanvas offcanvas-end custom-offcanvas w-50 me-auto" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
        <div  class="offcanvas-header  gap-3 ">

          <a class="navbar-brand lgo    " href="index.html">
            <img style="width: 40px;height: 40px;" src="./images/umsalogo.png" alt="Logo"  class="d-inline-block align-text-top ">
            UMSA
          </a>
          <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div style="width: 100%; " class="offcanvas-body  m-auto">
            <ul class="navbar-nav justify-content-end flex-grow-1 ms-auto gap-3">
              <li class="nav-item ">
                <a class="nav-link  mt-1 "   href="index.html">Home</a>
              </li>
              <li class="nav-item dropdown">
                <a  style="color: gray;" class="nav-link dropdown-toggle aut_menu4  mt-1 " href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Posts
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item ndropdown-item nav-item2" href="allposts.html">Posts</a></li>
                  <li><a class="dropdown-item ndropdown-item nav-item2" href="allEvent.html">Upcoming Events</a></li>
                  <li><a class="dropdown-item ndropdown-item nav-item2" href="allNotice.html">Notice</a></li>
                </ul>
              </li>
              
              <li class="nav-item dropdown">
                <a style="color: gray;"  class="nav-link dropdown-toggle mt-1 " href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Pages
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item ndropdown-item nav-item2" href="aboutUs.html">About Us</a></li>
                  <li><a class="dropdown-item ndropdown-item nav-item2" href="service.html">Services</a></li>
                  <li><a class="dropdown-item ndropdown-item nav-item2" href="contactus.html">Contact Us</a></li>
                  <li><a class="dropdown-item ndropdown-item aut_menu2 nav-item2" href="blood.html">Blood</a></li>
                  <li><a class="dropdown-item ndropdown-item aut_menu1 nav-item2" href="people.html">Members</a></li>
                  <li><a class="dropdown-item ndropdown-item aut_menu nav-item2" href="account.html">Exchequer</a></li>
                </ul>
              </li>
              
              <li  class="nav-item pt-1">
                <a style="background-color: #3BCF93 ; border-radius: 5px;" class="nav-link aut_menu3 text-white " href="transaction.html">Donate</a>
              </li>
              <li class="nav-item dropdown">
                <a  class="nav-link   activpage" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            
                    
                    <img
                    id="profile_icon"
                    style="height: 32px; width: 32px;  margin-left: 0px; border: 2px solid #095e40; border-radius:28px; background-color: #ffff; "
                    src="./images/profile.png"
                    alt="Default Profile"
                    />
                    <img
                    id="profile_icon2"
                    style="height: 32px; width: 32px;  margin-left: 0px; display: none; border-radius: 50%; border: 4px solid #3BCF93"
                    src=""
                    alt="User Profile"
                    />
                </a>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item ndropdown-item  menu dash-menu d-none nav-item2 activpage textp" href="dashboard.html">Dashboard</a></li>
                  <li><a class="dropdown-item ndropdown-item menu login-menu1 nav-item2" href="login.html">Login</a></li>
                  <li><a class="dropdown-item ndropdown-item menu registration-menu1 nav-item2" href="registration.html">Sign_Up</a></li>
                  <li><a class="dropdown-item ndropdown-item menu logout-menu1 d-none nav-item2" onclick="handlelogOut()" href="#">Logout</a></li>
                </ul>
              </li>


            </ul>
          </div>
        </div>
      </div>
    </nav>
    

    <main class="bg-white">
        <div class="banner-container ">
            <div class=" row w-100 m-auto">
              <div class=" dash_bar col-md-2 col-lg-2 py-5" style="padding: 5px 10px 10px 10px;  ">
                <div ><a class=""  href="dashboard.html">Profile</a></div>
                <div ><a href="updateProfile.html">Update Profile</a></div>
                <div><a href="changepass.html">Change Password</a></div>
                <div ><a href="MyDonateHistory.html">My Donate History</a></div>
                <div class="btc" ><a class="text-light" href="myDonate.html">donate</a></div>
                <div><a href="addPostUser.html">All Post</a></div>
                
              </div>
              <div class="  col-md-10 col-lg-10">
                <div class=" pb-5">
                  <form style="box-shadow: rgba(0, 0, 0, 0.1) 0px 20px 25px -5px, rgba(0, 0, 0, 0.04) 0px 10px 10px -5px;" class="w-50 mx-auto my-3 px-5 pb-5" id="transactionFormToDonate">
                    <h3 class="text-center mt-3 mb-5">Donate</h3>
                    <div class="d-flex justify-content-between row">
                        <div class="col-lg-6 col-md-6">
                            <label>Reference: <input type="text" id="reference"></label>
                            <label>Amount: <input type="number" id="amount" required></label>
                            <input type="hidden" id="typys" value="credit">
                            <label>Source: <input type="text" id="sourcePeople"></label>
                            <label>Purpose: <input type="text" id="purpose"></label>
                        </div>
                        <div class="col-lg-6 col-md-6">
                            <label>Comment: <input type="text" id="comment"></label>
                            <label >Media:
                              <select  id="media">
                                  <option value="Bank">Bank</option>
                                  <option value="Card">Card</option>
                                  <option value="Mobile Banking">Mobile Banking</option>
                              </select>
                            </label>
                            <label>Account No: <input type="number" id="accountNo"></label>
                            <input type="hidden" id="approved">
                            <button class="pay" type="submit">Payment</button>
                        </div>
                    </div>
                    
                  </form>
                  
                    
                    <!-- <form class="w-50 mx-auto my-5 px-5" id="transactionFormToDonate">
                        <h3 class="text-center my-4">Donate</h3>
                        <input type="hidden" id="transactionId">
                        <div class="d-flex justify-content-between row">
                          <div class="col-lg-6 col-md-6">
                            <label>TRX ID: <input type="text" id="trxId" required></label>
                            <label>Reference: <input type="text" id="reference"></label>
                            <label>Amount: <input type="number" id="amount" required></label>
                            <input type="hidden" id="typys" value="credit">
                            <label>Source: <input type="text" id="sourcePeople"></label>
                          </div>
                          <div class="col-lg-6 col-md-6">
                            <label>Media: <input type="text" id="media"></label>
                            <label>Purpose: <input type="text" id="purpose"></label>
                            <label>Comment: <input type="text" id="comment"></label>
                            <input type="hidden" id="approved">
                          </div>

                        </div>
                        
                        
                        
                        
                        
                        
                        <div class="w-50 m-auto py-4">
                          <button class="btn btc px-3 text-white py-2" type="submit">Send</button>
                        </div>
                    </form> -->
                  </div>
                </div>
              </div>
            </div>
          </div>
    </main>
    <footer style="background-color: #222222; color: white;" class="pt-4 pb-2">
      <div  class="   ">
        <div style="width: 93%;" class="d-flex justify-content-between  container-fluid row ps-5  m-auto my-5">
          <div  class="col-md-2 col-lg-2  ">
            <img style="width:60px; height: 60px;" class="   img-fluid" src="./images/umsal.png" alt="">
            
            <h3 class="pt-3 textp">UMSA Family</h3>
            <p>Consectetur adipiscing elttid labereore Qweeuis ium suspen edisse ultrices.</p>
          </div>
          <div class="col-md-2 col-lg-2">
            <h5 style="color: #3BCF93;">UMSA</h5><br>
            <p>+880-2353-352-555</p>
            <p>+880-2353-352547</p>
            <p>UMSA45h65@gmail.com</p>
            <p>512/B Lloyd Ladner Rd,</p>
            <p>Christian, MS, 39571</p>
          </div>
          <div class="col-md-2 col-lg-2">
            <h5 style="color: #3BCF93;">Education</h5><br>
            <p>Admission Care</p>
            <p>Vission/Mission</p>
            <p>More Features</p>
            <p>Vission/Mission</p>
          </div>
          <div class="col-md-2 col-lg-2">
            <h5 style="color: #3BCF93;">Trustee Leadership</h5><br>
            <p>Qweeuis ium</p>
            <p>suspen edisse ultrices</p>
            <p>Gabtali, Bogra</p>
          </div>
          <div class="col-md-2 col-lg-2">
            <h5 style="color: #3BCF93;">Our Pages</h5><br>
            <p>About Us Page</p>
            <p>About Us Page</p>
            <p>Service Page</p>
            <p>Blood Doners Page</p>
          </div>
        </div>
        <div  class="w-75 m-auto text-center">
          <hr style="width: 100%;" class="m-auto my-5">
          <div class="icons">
            <img class="icon bg-white contact" src="./images/icon/email.png" alt="" />
            <img class="icon bg-white contact" src="./images/icon/yt.png" alt="" />
            <img class="icon bg-white contact" src="./images/icon/fb.png" alt="" />
            <img class="icon bg-white contact" src="./images/icon/in.png" alt="" />
            <img class="icon bg-white contact" src="./images/icon/telegram.png" alt="" />
            <img class="icon bg-white contact" src="./images/icon/whatsapp.png" alt="" />
          </div>
        </div>
        
      </div>
      <p class="text-center mt-3 mb-5">
        <small>Copyright ¬© 2025 UMSA Family. All Rights Reserved</small>
      </p>
    </footer>
    <!-- <footer style="background-color: #222222; color: aliceblue;" class="pt-4 pb-2 ">
      <div  class="   ">
        <div  class="w-75 m-auto text-center">
          <img style="width: 10%;" class=" m-auto pb-3 img-fluid" src="./images/umsal.png" alt="">
          <div class="icons">
            <img class="icon bg-white contact" src="./images/icon/email.png" alt="" />
            <img class="icon bg-white contact" src="./images/icon/yt.png" alt="" />
            <img class="icon bg-white contact" src="./images/icon/fb.png" alt="" />
            <img class="icon bg-white contact" src="./images/icon/in.png" alt="" />
            <img class="icon bg-white contact" src="./images/icon/telegram.png" alt="" />
            <img class="icon bg-white contact" src="./images/icon/whatsapp.png" alt="" />
          </div>
        </div>
        
      </div>
      <p class="text-center mt-3">
        <small>Copyright ¬© 2025 UMSA Family. All Rights Reserved</small>
      </p>
  </footer> -->
    <script
      src="https://cdn.jsdelivr.net/npm/swiffy-slider@1.6.0/dist/js/swiffy-slider.min.js"
      crossorigin="anonymous"
      defer
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="./logout.js"></script>
    <script src="./index.js"></script>
    <script src="./index2.js"></script>
    <!-- <script src="./dashboard.js"></script> -->


    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.js"></script>
    <script>
        const apiUrl = "https://club-wine.vercel.app/transaction/";
        const apiUrlUser = "https://club-wine.vercel.app/users/";

        function fetchTransactions() {
            fetch(apiUrl)
                .then(response => response.json())
                .then(transactions => {
                    const tableBody = document.querySelector("#transactionTable tbody");
                    tableBody.innerHTML = ""; // Clear table

                    transactions.forEach(transaction => {
                        // Fetch user details for each transaction
                        fetch(`${apiUrlUser}${transaction.user}/`)
                            .then(response => response.json())
                            .then(user => {
                                // Extract username and fullname
                                const username = user.username || "N/A";
                                const first_name = user.first_name || "N/A";
                                const last_name = user.last_name || "N/A";

                                // Create a row for the transaction
                                const row = `
                                    <tr>
                                        <td>${transaction.id}</td>
                                        <td>${transaction.trx_id}</td>
                                        <td>${transaction.user}</td>
                                        <td>${username}</td>
                                        <td>${first_name} ${last_name}</td>
                                        <td>${transaction.reference || ''}</td>
                                        <td>${transaction.amount}</td>
                                        <td>${transaction.typys}</td>
                                        <td>${transaction.source_people || ''}</td>
                                        <td>${transaction.media || ''}</td>
                                        <td>${transaction.purpose || ''}</td>
                                        <td>${transaction.comment || ''}</td>
                                        <td>${transaction.created_at || ''}</td>
                                        <td>${transaction.updated_at || ''}</td>
                                        <td>${transaction.approved ? "Yes" : "No"}</td>
                                    </tr>
                                `;

                                // Append the row to the table
                                tableBody.insertAdjacentHTML("beforeend", row);
                            })
                            .catch(error => {
                                console.error(`Error fetching user details for user ID ${transaction.user}:`, error);
                            });
                    });
                })
                .catch(error => {
                    console.error("Error fetching transactions:", error);
                });
        }
        function fetchTransactions1() {
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.querySelector("#myTransactionTable tbody");
                    tableBody.innerHTML = ""; // Clear table

                    // Get the logged-in user ID from localStorage
                    const loggedInUserId = localStorage.getItem("user_id");
                    console.log("Logged-in user ID:", loggedInUserId);

                    // Check if loggedInUserId exists
                    if (!loggedInUserId) {
                        console.error("No logged-in user found!");
                        return;
                    }

                    let userFound = false;

                    // Iterate over the transactions
                    data.forEach(transaction => {
                        // Adjust this based on the structure of the 'user' field
                        const transactionUserId = transaction.user.id || transaction.user;
                         

                        if (transactionUserId === parseInt(loggedInUserId)) {
                            userFound = true;

                            fetch(`${apiUrlUser}${transaction.user}/`)
                                .then(response => response.json())
                                .then(user => {
                                    // Extract username and fullname
                                    const username = user.username || "N/A";
                                    const first_name = user.first_name || "N/A";
                                    const last_name = user.last_name || "N/A";

                                    // Create a row for the transaction
                                    const row = `
                                        <tr>
                                            <td>${transaction.id}</td>
                                            <td>${transaction.trx_id}</td>
                                            <td>${first_name} ${last_name}</td>
                                            <td>${transaction.reference || ''}</td>
                                            <td>${transaction.amount}</td>
                                            <td>${transaction.typys}</td>
                                            <td>${transaction.source_people || ''}</td>
                                            <td>${transaction.media || ''}</td>
                                            <td>${transaction.purpose || ''}</td>
                                            <td>${transaction.comment || ''}</td>
                                            <td>${transaction.created_at || ''}</td>
                                            <td>${transaction.updated_at || ''}</td>
                                            <td>${transaction.approved ? "Yes" : "No"}</td>
                                        </tr>
                                    `;

                                    // Append the row to the table
                                    tableBody.insertAdjacentHTML("beforeend", row);
                                })
                                .catch(error => {
                                    console.error(`Error fetching user details for user ID ${transaction.user}:`, error);
                                });                                                       
                        }
                    });

                    if (!userFound) {
                        tableBody.innerHTML = `<tr><td colspan="13">No transactions found for your account.</td></tr>`;
                    }
                })
                .catch(error => {
                    console.error("Error fetching transactions:", error);
                });
        }

        

        document.getElementById("transactionFormToDonate").addEventListener("submit", function(event) {
        event.preventDefault();
        const id = document.getElementById("transactionId").value;
        const method = id ? "PUT" : "POST";
        const url = id ? `${apiUrl}${id}/` : apiUrl;

        const transactionData = {
            user: localStorage.getItem("user_id"),
            trx_id: document.getElementById("trxId").value,
            reference: document.getElementById("reference").value,
            amount: document.getElementById("amount").value,
            typys: document.getElementById("typys").value,
            source_people: document.getElementById("sourcePeople").value,
            media: document.getElementById("media").value,
            purpose: document.getElementById("purpose").value,
            comment: document.getElementById("comment").value,
            approved: document.getElementById("approved").checked
        };

        fetch(url, {
            method: method,
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(transactionData),
        })
        .then(response => {
            if (response.ok) {
                fetchTransactions();
                document.getElementById("transactionFormToDonate").reset();
            }
        });
    });

    document.getElementById("transactionFormToDonate").addEventListener("submit", function(event) {
            event.preventDefault();

            const transactionData = {
                user: localStorage.getItem("user_id"),
                reference: document.getElementById("reference").value,
                amount: document.getElementById("amount").value,
                typys: document.getElementById("typys").value,
                source_people: document.getElementById("sourcePeople").value,
                purpose: document.getElementById("purpose").value,
                comment: document.getElementById("comment").value,
                media: document.getElementById("media").value,
                accountNo: document.getElementById("accountNo").value,
                approved: document.getElementById("approved").checked
                // urlgetway: document.getElementById("urlgetway").value
            };

            fetch("https://club-wine.vercel.app/payment/payment/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(transactionData)
            })
            .then(response => response.json())

            .then(data => {
                console.log("Response from backend:", data);  // Log response for debugging
                
                if (data) {
                  window.open(data, "_self");
                } else {
                    alert("Payment session creation failed: " + data.error);
                }
            })
            .catch(error => console.error("Error:", error));

        });
    </script>
    
    
    
  </body>
</html>
